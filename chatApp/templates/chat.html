{% extends "base.html" %}
{% load static %}

{% block main %}
<div class="container py-4">

  <!-- Top bar -->
  <div class="gpt-topbar mb-3">
    <div>
      <div class="gpt-title">Chat</div>
      <div class="gpt-subtitle">
        Ask about CS:APP Chapter 2. This version has no chat memory yet (each question is independent).
      </div>
    </div>
    <div class="d-flex gap-2 align-items-center">
      <button class="btn btn-outline-secondary btn-sm" id="newChatBtn" type="button">New chat</button>
      <button class="btn btn-outline-danger btn-sm" id="clearBtn" type="button">Clear</button>
    </div>
  </div>

  <!-- Shell -->
  <div class="gpt-shell mx-auto">
    <div class="card shadow-sm gpt-card">
      <div class="card-body p-0 d-flex flex-column">

        <!-- Messages (empty at load; JS will render turns) -->
        <div id="messages"
             class="gpt-messages"
             role="log"
             aria-live="polite"
             aria-relevant="additions text">
        </div>

        <!-- Composer -->
        <div class="gpt-composer">
          <div class="composer-inner">
            <form id="chatForm" class="composer-form">
              {% csrf_token %}

              <div class="composer-box">
                <input
                  id="prompt"
                  class="form-control gpt-input"
                  type="text"
                  placeholder="Message…"
                  autocomplete="off"
                  required
                />

                <button class="btn btn-primary gpt-send" type="submit" id="sendBtn">
                  Send
                </button>
              </div>

              <div class="composer-hint">
                Press <kbd>Enter</kbd> to send • Use <kbd>Shift</kbd>+<kbd>Enter</kbd> for a new line
              </div>

              <!-- Optional: tiny disclaimer area -->
              <div class="small text-body-secondary mt-2">
                For learning only — verify important details with the textbook or your professor/peers.
              </div>
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>

</div>

<link rel="stylesheet" href="{% static 'chatApp/css/chat.css' %}">
<script src="{% static 'chatApp/js/chat.js' %}"></script>

<!-- Expose endpoint + csrf to JS safely -->
<script>
  window.CHAT_ENDPOINT = "{% url 'ask' %}";  // change name if your URL name differs
  window.CSRF_TOKEN = document.querySelector('[name=csrfmiddlewaretoken]')?.value;
</script>
{% endblock %}
