{% load static %}
<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAG Chat</title>

  <!-- Bootstrap 5.3 (has built-in theme support) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="{% static 'chat/styles.css' %}">
</head>

<body class="min-vh-100 d-flex flex-column">
  <!-- Top bar -->
  <nav class="navbar border-bottom">
    <div class="container-fluid px-3 px-md-4">
      <a class="navbar-brand fw-bold" href="#">RAG Chat</a>

      <div class="d-flex align-items-center gap-2">
        <span class="small opacity-75 d-none d-sm-inline" id="themeLabel">Light</span>

        <!-- Theme toggle -->
        <button class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2"
                type="button" id="themeToggle" aria-label="Toggle theme">
          <span id="themeIcon" aria-hidden="true">üåô</span>
          <span class="d-none d-md-inline">Theme</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container-fluid flex-grow-1">
    <div class="row g-0 h-100">
      <!-- Sidebar: upload + info -->
      <aside class="col-12 col-lg-3 border-end p-3 p-md-4 sidebar">
        <h6 class="text-uppercase small fw-bold opacity-75 mb-3">Knowledge Base</h6>

        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <h6 class="card-title mb-2">Upload documents</h6>
            <p class="small opacity-75 mb-3">
              Add PDFs / text so the assistant can cite them.
            </p>

            <form method="post" action="{% url 'chat:upload' %}" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="mb-2">
                <input class="form-control form-control-sm" type="file" name="files" multiple
                       accept=".pdf,.txt,.md,.docx" />
              </div>
              <button class="btn btn-primary btn-sm w-100" type="submit">Upload</button>
            </form>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="card-title mb-2">Tips</h6>
            <ul class="small mb-0 opacity-75">
              <li>Ask questions like ‚Äúsummarize chapter 2‚Äù.</li>
              <li>Try: ‚Äúcite the source for that claim‚Äù.</li>
              <li>Upload class notes as PDFs.</li>
            </ul>
          </div>
        </div>
      </aside>

      <!-- Chat area -->
      <section class="col-12 col-lg-9 d-flex flex-column chat-area">
        <!-- Chat header -->
        <div class="border-bottom p-3 p-md-4 d-flex align-items-center justify-content-between">
          <div>
            <h5 class="mb-0">Chat</h5>
            <div class="small opacity-75">Ask questions. Get answers with sources.</div>
          </div>
          <button class="btn btn-outline-danger btn-sm" id="clearBtn" type="button">Clear</button>
        </div>

        <!-- Messages -->
        <div class="flex-grow-1 overflow-auto p-3 p-md-4" id="messages">
          <!-- Example messages (remove later) -->
          <div class="msg-row">
            <div class="msg msg-bot">
              <div class="msg-meta">Assistant</div>
              <div class="msg-bubble">
                Upload a document, then ask me something about it.
              </div>
              <div class="msg-sources small opacity-75 mt-2">
                <span class="badge text-bg-secondary">source: syllabus.pdf</span>
              </div>
            </div>
          </div>

          <div class="msg-row justify-content-end">
            <div class="msg msg-user">
              <div class="msg-meta text-end">You</div>
              <div class="msg-bubble">
                What‚Äôs the grading policy?
              </div>
            </div>
          </div>
        </div>

        <!-- Composer -->
        <div class="border-top p-3 p-md-4">
          <form id="chatForm" class="d-flex gap-2">
            <input
              class="form-control"
              id="prompt"
              type="text"
              placeholder="Type your question‚Ä¶"
              autocomplete="off"
              required
            />
            <button class="btn btn-primary" type="submit" id="sendBtn">
              Send
            </button>
          </form>
          <div class="small opacity-75 mt-2">
            Press <kbd>Enter</kbd> to send. Use the toggle for dark/light theme.
          </div>
        </div>
      </section>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'chat/app.js' %}"></script>
</body>
</html>
